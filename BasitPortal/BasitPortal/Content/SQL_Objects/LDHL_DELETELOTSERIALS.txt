ALTER PROC [dbo].[LDHL_DELETELOTSERIALS] 
@OrderID INT,
@LOT VARCHAR(20),
@User_ID INT = 0
as 
BEGIN
	DECLARE @ORDCODE VARCHAR(20);
	
SELECT 
	@ORDCODE = WAOR_CODE
FROM
	LWMS_WAREHOUSEORDER (NOLOCK)
WHERE
	WAOR_ID = @OrderID
--PRINT 'ORDCODE = ' + CAST(@ORDCODE AS VARCHAR);
--BEGIN TRAN

DELETE FROM 
	LWMS_SERIALLISTPACK 
WHERE 
	SLPA_WAREHOUSEORDERID = @ORDCODE 
	AND SLPA_ID IN 
		(SELECT SELL_ID FROM LWMS_SERIALLISTLOG 
			WHERE SELL_WAREHOUSEORDERID = @OrderID AND SELL_REFERANCENO3 = @LOT);

DELETE FROM 
	LWMS_SERIALLISTLOG 
WHERE SELL_WAREHOUSEORDERID = @OrderID AND SELL_REFERANCENO3 = @LOT;

--ROLLBACK TRAN

END
